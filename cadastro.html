<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon" />
  <title>Cadastro de Agências</title>

  <!-- ========== CSS Files ========== -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/lineicons.css" />
  <link rel="stylesheet" href="assets/css/quill/bubble.css" />
  <link rel="stylesheet" href="assets/css/quill/snow.css" />
  <link rel="stylesheet" href="assets/css/fullcalendar.css" />
  <link rel="stylesheet" href="assets/css/morris.css" />
  <link rel="stylesheet" href="assets/css/datatable.css" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <style>
    /* Layout do Dashboard com Sidebar */
    .main-wrapper {
      margin-left: 260px; /* espaço para a sidebar */
      padding: 20px;
      min-height: 100vh;
      background-color: #f8f9fa;
    }
    /* Header fixo */
    .header {
      background: #fff;
      border-bottom: 1px solid #ddd;
      height: 60px;
      display: flex;
      align-items: center;
      padding: 0 20px;
      position: fixed;
      left: 260px;
      right: 0;
      top: 0;
      z-index: 998;
    }
    .header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    /* Espaçamento do conteúdo para não ficar atrás do header */
    .cadastro-container {
      margin-top: 80px;
    }
    /* Controle dos Steps do Formulário */
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Preloader Único -->
  <div id="preloader">
    <div class="spinner"></div>
  </div>

  <!-- Importa e inicializa a Sidebar -->
  <script type="module">
    import { initAirlandPage } from './assets/js/sidebar.js';
    initAirlandPage();
  </script>

  <!-- Header do Dashboard -->
  <header class="header">
    <div class="container-fluid">
      <div class="row">
        <!-- Botão de Toggle da Sidebar -->
        <div class="col-lg-5 col-md-5 col-6">
          <div class="header-left d-flex align-items-center">
            <div class="menu-toggle-btn me-3">
              <button id="menu-toggle" class="main-btn primary-btn btn-hover">
                <i class="lni lni-chevron-left me-2"></i> Menu
              </button>
            </div>
          </div>
        </div>
        <!-- Espaço para Notificações / Perfil -->
        <div class="col-lg-7 col-md-7 col-6">
          <div class="header-right">
            <!-- Itens do header, se necessário -->
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Wrapper: Conteúdo do Dashboard -->
  <main class="main-wrapper">
    <div class="cadastro-container container-fluid">
      <div class="row">
        <div class="col-12">
          <h2>Cadastro de Agências</h2>
          <p>Preencha os passos abaixo para cadastrar sua agência.</p>
          
          <!-- Step 1: Dados do Usuário -->
          <div id="step1" class="step active">
            <h5>Step 1 – Dados do Usuário</h5>
            <form id="userForm">
              <div class="row">
                <!-- Primeiro Nome e Último Nome -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Primeiro Nome *</label>
                  <input type="text" name="primeiro_nome" class="form-control" placeholder="Primeiro Nome" required />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Último Nome *</label>
                  <input type="text" name="ultimo_nome" class="form-control" placeholder="Último Nome" required />
                </div>
                <!-- Telefone e Email -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Telefone *</label>
                  <input type="text" name="telefone" class="form-control" placeholder="Telefone" required />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Email *</label>
                  <input type="email" name="email" class="form-control" placeholder="Email" required />
                </div>
                <!-- Foto de Perfil -->
                <div class="col-12 mb-3">
                  <label class="form-label">Foto de Perfil</label>
                  <input type="file" name="fotodeperfil" class="form-control" accept="image/*" />
                </div>
                <!-- Senha e Repetir Senha -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Senha *</label>
                  <input type="password" id="password" name="password" class="form-control" placeholder="Senha" required />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Repetir Senha *</label>
                  <input type="password" id="confirm_password" name="confirm_password" class="form-control" placeholder="Repetir Senha" required />
                </div>
                <!-- Campos Hidden -->
                <input type="hidden" name="affiliate_id" id="affiliate_id" />
                <input type="hidden" name="name" id="name" />
                <!-- Botão Próximo -->
                <div class="col-12">
                  <button type="button" class="btn btn-primary w-100" onclick="goToStep2(event)">Próximo</button>
                </div>
              </div>
            </form>
          </div>
          <!-- Fim do Step 1 -->

          <!-- Step 2: Dados da Agência -->
          <div id="step2" class="step">
            <h5>Step 2 – Dados da Agência</h5>
            <form id="affiliateForm">
              <div class="row">
                <!-- Nome da Agência -->
                <div class="col-12 mb-3">
                  <label class="form-label">Nome da Agência *</label>
                  <input type="text" name="agency_name" class="form-control" placeholder="Nome da Agência" required />
                </div>
                <!-- Domínio Próprio -->
                <div class="col-12 mb-3">
                  <label class="form-label">Você tem domínio próprio? *</label>
                  <div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="has_domain" id="domainYes" value="sim" onclick="toggleDomainFields()" required>
                      <label class="form-check-label" for="domainYes">Sim</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="has_domain" id="domainNo" value="nao" onclick="toggleDomainFields()" required>
                      <label class="form-check-label" for="domainNo">Não</label>
                    </div>
                  </div>
                </div>
                <!-- Campo para Domínio (quando sim) -->
                <div class="col-12 mb-3" id="domainField" style="display: none;">
                  <label class="form-label">Domínio *</label>
                  <input type="text" name="domain" class="form-control" placeholder="seuagencia.com" />
                </div>
                <!-- Campo para Subdomínio (quando não) -->
                <div class="col-12 mb-3" id="subdomainField" style="display: none;">
                  <label class="form-label">Subdomínio *</label>
                  <input type="text" name="subdomain" class="form-control" placeholder="airland.com.br" value="airland.com.br" readonly />
                </div>
                <!-- Logo URL -->
                <div class="col-12 mb-3">
                  <label class="form-label">Logo URL *</label>
                  <input type="text" name="logo_url" class="form-control" placeholder="URL da Logo" required />
                </div>
                <!-- Cores: Primary e Background -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cor Principal</label>
                  <input type="text" name="primary_color" class="form-control" placeholder="Ex: #000000" />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cor Secundária</label>
                  <input type="text" name="background_color" class="form-control" placeholder="Ex: #FFFFFF" />
                </div>
                <!-- Cores: Button e Button Text -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cor do Botão</label>
                  <input type="text" name="button_color" class="form-control" placeholder="Ex: #FF0000" />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cor do Texto do Botão</label>
                  <input type="text" name="button_text_color" class="form-control" placeholder="Ex: #FFFFFF" />
                </div>
                <!-- Cor do Botão ao Clicar -->
                <div class="col-12 mb-3">
                  <label class="form-label">Cor do Botão ao Clicar</label>
                  <input type="text" name="button_hover" class="form-control" placeholder="Ex: #CCCCCC" />
                </div>
                <!-- Botão Enviar -->
                <div class="col-12">
                  <button type="button" class="btn btn-success w-100" onclick="submitForms(event)">Enviar</button>
                </div>
              </div>
            </form>
          </div>
          <!-- Fim do Step 2 -->
        </div>
      </div>
    </div>
  </main>

  <!-- Footer do Dashboard -->
  <footer class="footer">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-6 order-last order-md-first">
          <div class="copyright text-center text-md-start">
            <p class="text-sm">
              Designed and Developed by
              <a href="https://airland.com.br" target="_blank" rel="nofollow">Airland</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Theme Option Box -->
  <button class="option-btn">
    <i class="lni lni-cog"></i>
  </button>
  <div class="option-overlay"></div>
  <div class="option-box">
    <div class="option-header">
      <h5>Configurações</h5>
      <button class="option-btn-close text-gray">
        <i class="lni lni-close"></i>
      </button>
    </div>
    <h6 class="mb-10">Disposição</h6>
    <ul class="mb-30">
      <li><button class="leftSidebarButton active">Barra Lateral Esquerda</button></li>
      <li><button class="rightSidebarButton">Barra Lateral Direita</button></li>
    </ul>
    <h6 class="mb-10">Tema</h6>
    <ul class="d-flex flex-wrap align-items-center">
      <li>
        <button class="lightThemeButton active">Tema Claro + Barra Lateral 1</button>
      </li>
      <li>
        <button class="darkThemeButton">Tema Escuro + Barra Lateral 1</button>
      </li>
    </ul>
    <div class="promo-box">
      <div class="promo-icon">
        <img class="mx-auto" src="assets/images/logo/logo-icon-big.svg" alt="Logo">
      </div>
      <h3 id="promoName">(Nome da Pessoa)</h3>
      <p>Improve your development process and start doing more with Airland PRO!</p>
      <a href="https://Airland.com/pro" target="_blank" rel="nofollow" class="main-btn primary-btn btn-hover">
        Upgrade to PRO
      </a>
    </div>
  </div>

  <!-- ========== JS Files ========== -->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/Chart.min.js"></script>
  <script src="assets/js/apexcharts.min.js"></script>
  <script src="assets/js/dynamic-pie-chart.js"></script>
  <script src="assets/js/moment.min.js"></script>
  <script src="assets/js/fullcalendar.js"></script>
  <script src="assets/js/jvectormap.min.js"></script>
  <script src="assets/js/world-merc.js"></script>
  <script src="assets/js/polyfill.js"></script>
  <script src="assets/js/quill.min.js"></script>
  <script src="assets/js/datatable.js"></script>
  <script src="assets/js/Sortable.min.js"></script>
  <!-- Importa main.js após a sidebar ser inserida -->
  <script src="./assets/js/main.js"></script>

  <!-- Inline Scripts para as funções do formulário -->
  <script>
    // Transição do Step 1 para o Step 2 (validação de senhas)
    function goToStep2(e) {
      e.preventDefault();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm_password').value;
      if (password !== confirmPassword) {
        alert('As senhas não coincidem!');
        return;
      }
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step2').classList.add('active');
    }
    // Exibe/esconde o campo de domínio ou subdomínio
    function toggleDomainFields() {
      const hasDomain = document.querySelector('input[name="has_domain"]:checked').value;
      if (hasDomain === 'sim') {
        document.getElementById('domainField').style.display = 'block';
        document.getElementById('subdomainField').style.display = 'none';
        document.querySelector('input[name="domain"]').required = true;
        document.querySelector('input[name="subdomain"]').required = false;
      } else {
        document.getElementById('domainField').style.display = 'none';
        document.getElementById('subdomainField').style.display = 'block';
        document.querySelector('input[name="subdomain"]').required = true;
        document.querySelector('input[name="domain"]').required = false;
      }
    }
    // Simula o envio dos formulários (Step 2 e depois Step 1)
    function submitForms(e) {
      e.preventDefault();
      const agencyName = document.querySelector('input[name="agency_name"]').value;
      const logoUrl = document.querySelector('input[name="logo_url"]').value;
      if (!agencyName || !logoUrl) {
        alert('Por favor, preencha todos os campos obrigatórios da Agência.');
        return;
      }
      const hasDomainElem = document.querySelector('input[name="has_domain"]:checked');
      if (!hasDomainElem) {
        alert('Por favor, responda se possui domínio próprio.');
        return;
      }
      const hasDomain = hasDomainElem.value;
      if (hasDomain === 'sim') {
        const domain = document.querySelector('input[name="domain"]').value;
        if (!domain) {
          alert('Por favor, informe o domínio.');
          return;
        }
      } else {
        const subdomain = document.querySelector('input[name="subdomain"]').value;
        if (!subdomain) {
          alert('Por favor, confirme o subdomínio.');
          return;
        }
      }
      // Simulação: gera um affiliateId
      const affiliateId = 'AFF' + Math.floor(Math.random() * 100000);
      document.getElementById('affiliate_id').value = affiliateId;
      // Concatena primeiro e último nome
      const primeiroNome = document.querySelector('input[name="primeiro_nome"]').value;
      const ultimoNome = document.querySelector('input[name="ultimo_nome"]').value;
      document.getElementById('name').value = primeiroNome + ' ' + ultimoNome;
  
      const affiliateData = {
        agency_name: agencyName,
        has_domain: hasDomain,
        domain: hasDomain === 'sim' ? document.querySelector('input[name="domain"]').value : '',
        subdomain: hasDomain === 'nao' ? document.querySelector('input[name="subdomain"]').value : '',
        logo_url: logoUrl,
        primary_color: document.querySelector('input[name="primary_color"]').value,
        background_color: document.querySelector('input[name="background_color"]').value,
        button_color: document.querySelector('input[name="button_color"]').value,
        button_text_color: document.querySelector('input[name="button_text_color"]').value,
        button_hover: document.querySelector('input[name="button_hover"]').value
      };
      console.log('Dados da Agência (Step 2):', affiliateData);
  
      const userData = {
        primeiro_nome: primeiroNome,
        ultimo_nome: ultimoNome,
        telefone: document.querySelector('input[name="telefone"]').value,
        email: document.querySelector('input[name="email"]').value,
        fotodeperfil: document.querySelector('input[name="fotodeperfil"]').files[0],
        password: document.getElementById('password').value,
        affiliate_id: affiliateId,
        name: document.getElementById('name').value
      };
      console.log('Dados do Usuário (Step 1):', userData);
  
      alert('Formulário enviado com sucesso! Affiliate ID gerado: ' + affiliateId);
    }
  </script>
</body>
</html>
