<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon" />
    <title>Login | PlainAdmin Demo</title>
    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/lineicons.css" />
    <link rel="stylesheet" href="assets/css/quill/bubble.css" />
    <link rel="stylesheet" href="assets/css/quill/snow.css" />
    <link rel="stylesheet" href="assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="assets/css/morris.css" />
    <link rel="stylesheet" href="assets/css/datatable.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
  </head>
  <body>
    <div class="row g-0 auth-row">
      <div class="col-lg-6">
        <div class="auth-cover-wrapper bg-primary-100">
          <div class="auth-cover">
            <div class="title text-center">
              <h1 class="text-primary mb-10">Bem-vindo de volta</h1>
              <p class="text-medium">
                Entre na sua conta existente para continuar
              </p>
            </div>
            <div class="cover-image">
              <img src="assets/images/auth/signin-image.svg" alt="Imagem de login" />
            </div>
            <div class="shape-image">
              <img src="assets/images/auth/shape.svg" alt="Shape" />
            </div>
          </div>
        </div>
      </div>
      <!-- end col -->
      <div class="col-lg-6">
        <div class="signin-wrapper">
          <div class="form-wrapper">
            <h6 class="mb-15">Acesso a Plataforma</h6>
            <p class="text-sm mb-25">
              É neste lugar que o comum fica para trás e o extraordinário se torna possível.
            </p>
            <!-- Div para exibir erros -->
            <div id="error-message" class="alert alert-danger" style="display: none;"></div>
            <!-- Formulário de login -->
            <form id="login-form">
              <div class="row">
                <div class="col-12">
                  <div class="input-style-1">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="Email" required />
                  </div>
                </div>
                <!-- end col -->
                <div class="col-12">
                  <div class="input-style-1">
                    <label>Senha</label>
                    <input type="password" name="password" placeholder="Senha" required />
                  </div>
                </div>
                <!-- end col -->
                <div class="col-xxl-6 col-lg-12 col-md-6">
                  <div class="form-check checkbox-style mb-30">
                    <input class="form-check-input" type="checkbox" value="" id="checkbox-remember" />
                    <label class="form-check-label" for="checkbox-remember">
                      Lembre-se de mim.
                    </label>
                  </div>
                </div>
                <!-- end col -->
                <div class="col-xxl-6 col-lg-12 col-md-6">
                  <div class="text-start text-md-end text-lg-start text-xxl-end mb-30">
                    <a href="reset-Senha.html" class="hover-underline">
                      Esqueceu sua senha?
                    </a>
                  </div>
                </div>
                <!-- end col -->
                <div class="col-12">
                  <div class="button-group d-flex justify-content-center flex-wrap">
                    <button type="submit" class="main-btn primary-btn btn-hover w-100 text-center">
                      Login
                    </button>
                  </div>
                </div>
              </div>
              <!-- end row -->
            </form>
            <div class="singin-option pt-40">
              <p class="text-sm text-medium text-center text-gray">
                Login facilitado com
              </p>
              <div class="button-group pt-40 pb-40 d-flex justify-content-center flex-wrap">
                <button class="main-btn primary-btn-outline m-2">
                  <i class="lni lni-facebook-fill mr-10"></i>
                  Facebook
                </button>
                <button class="main-btn danger-btn-outline m-2">
                  <i class="lni lni-google mr-10"></i>
                  Google
                </button>
              </div>
              <p class="text-sm text-medium text-dark text-center">
                Ainda não tem uma conta?
                <a href="signup.html">Crie uma conta</a>
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- end col -->
    </div>
    <!-- end row -->

    <!-- ========= All Javascript files linkup ======== -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/Chart.min.js"></script>
    <script src="assets/js/apexcharts.min.js"></script>
    <script src="assets/js/dynamic-pie-chart.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <script src="assets/js/fullcalendar.js"></script>
    <script src="assets/js/jvectormap.min.js"></script>
    <script src="assets/js/world-merc.js"></script>
    <script src="assets/js/polyfill.js"></script>
    <script src="assets/js/quill.min.js"></script>
    <script src="assets/js/datatable.js"></script>
    <script src="assets/js/Sortable.min.js"></script>
    <!-- Removido assets/js/main.js para evitar conflitos -->

    <!-- Lógica de login via JavaScript utilizando o endpoint /api/login -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("login-form");
        const errorDiv = document.getElementById("error-message");

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          // Limpa mensagem de erro
          errorDiv.style.display = "none";
          errorDiv.innerText = "";

          // Obtém os valores do formulário
          const email = form.email.value.trim();
          const password = form.password.value.trim();

          if (!email || !password) {
            errorDiv.innerText = "Por favor, preencha todos os campos.";
            errorDiv.style.display = "block";
            return;
          }

          try {
            // Usa uma URL relativa para acessar o endpoint de API internamente
            const response = await fetch("/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              credentials: "include", // Para envio/recebimento de cookies de sessão
              body: JSON.stringify({ email, password })
            });

            // Se a resposta não for OK, tenta ler a mensagem de erro e lança a exceção
            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || "Erro na requisição: " + response.status);
            }

            const data = await response.json();

            if (data.success) {
              // Salva os dados do usuário no localStorage (pode incluir também session e affiliate se necessário)
              localStorage.setItem("affiliateUser", JSON.stringify(data.user));

              // Redireciona para a área logada (dashboard, etc.)
              window.location.href = "http://businessplace.airland.com.br/index.html";
            } else {
              errorDiv.innerText = data.error || "Email ou senha incorretos!";
              errorDiv.style.display = "block";
            }
          } catch (err) {
            console.error(err);
            errorDiv.innerText = "Ocorreu um erro ao realizar o login: " + err.message;
            errorDiv.style.display = "block";
          }
        });
      });
    </script>
  </body>
</html>
